<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Start Workflow Popup</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 10px;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        label {
            font-weight: bold;
        }
        input, textarea {
            padding: 5px;
            font-size: 14px;
        }
        button {
            padding: 8px;
            font-size: 16px;
            background-color: #0079bf;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #005f8d;
        }
    </style>
</head>
<body>

<form id="custom-form">
    <label for="duration">‚è± Czas trwania (h):</label>
    <input type="number" name="duration" id="duration" required>

    <label for="description">üìù Opis zadania:</label>
    <textarea name="description" id="description" rows="3" required></textarea>

    <button type="submit">üöÄ Start i wy≈õlij</button>
</form>

<script src="https://p.trellocdn.com/power-up.min.js"></script>
<script>
    const t = TrelloPowerUp.iframe();

    document.getElementById('custom-form').addEventListener('submit', function (e) {
        e.preventDefault();

        const formData = new FormData(e.target);
        const duration = formData.get('duration');
        const description = formData.get('description');

        Promise.all([
            t.card('id', 'name', 'shortLink'),
            t.member('username')
        ]).then(([card, user]) => {
            return fetch('https://n8n.cosmicweb.cloud/webhook-test/trello-button', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: 'custom',
                    card,
                    user,
                    timestamp: new Date().toISOString(),
                    duration,
                    description
                })
            });
        }).then(() => {
            t.closeModal();
        });
    });

    t.sizeTo('#custom-form').done();
</script>

</body>
</html>
