<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Test Power-Up</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
  <h3>Wybierz projekty:</h3>
  <div id="checkboxes">
    <label><input type="checkbox" value="projekt1"> projekt1</label><br>
    <label><input type="checkbox" value="projekt2"> projekt2</label><br>
    <label><input type="checkbox" value="projekt3"> projekt3</label><br>
  </div>
  <button id="save">ðŸ’¾ Zapisz do t.set()</button>

  <hr>

  <h3>Projekty z t.set:</h3>
  <select id="projectSelect">
    <option>-- Wczytywanie... --</option>
  </select>

  <script>
    const t = TrelloPowerUp.iframe();

    const checkboxContainer = document.getElementById('checkboxes');
    const saveBtn = document.getElementById('save');
    const select = document.getElementById('projectSelect');

    // Funkcja zapisu zaznaczonych projektÃ³w do t.set
    saveBtn.addEventListener('click', () => {
      const checkboxes = checkboxContainer.querySelectorAll('input[type="checkbox"]:checked');
      const selected = Array.from(checkboxes).map(cb => cb.value);

      if (selected.length === 0) {
        alert('Wybierz co najmniej jeden projekt!');
        return;
      }

      t.set('card', 'shared', 'selectedProjects', selected)
        .then(() => {
          alert('Zapisano do t.set!');
          updateDropdown(selected);
        });
    });

    // Funkcja Å‚adowania zapisanych projektÃ³w i aktualizacji dropdowna
    function updateDropdown(projectList) {
      select.innerHTML = '';

      if (!projectList || projectList.length === 0) {
        const opt = document.createElement('option');
        opt.textContent = '-- Brak zapisanych projektÃ³w --';
        select.appendChild(opt);
        return;
      }

      const defaultOpt = document.createElement('option');
      defaultOpt.textContent = '-- Wybierz projekt --';
      defaultOpt.disabled = true;
      defaultOpt.selected = true;
      select.appendChild(defaultOpt);

      projectList.forEach(project => {
        const opt = document.createElement('option');
        opt.value = project;
        opt.textContent = project;
        select.appendChild(opt);
      });
    }

    // Przy starcie iframe pobierz dane z t.set
    t.get('card', 'shared', 'selectedProjects')
      .then(savedProjects => {
        updateDropdown(savedProjects || []);
      });
  </script>
</body>
</html>
